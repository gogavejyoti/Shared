public class ChatSessionDto
{
	public Guid SessionId { get; set; }
	public DateTime CreatedAt { get; set; }
	public string Preview { get; set; }
}

public async Task<IActionResult> GetChatSessions(string userId)
{
	var sessions = await _db.QueryAsync<ChatSessionDto>(@"
		SELECT 
			SessionId,
			MIN(CreatedAt) AS CreatedAt,
			LEFT(MAX(CASE WHEN Role = 'user' THEN Message END), 30) + '...' AS Preview
		FROM ChatHistory
		WHERE UserId = @UserId
		GROUP BY SessionId
		ORDER BY CreatedAt DESC
	", new { UserId = userId });

	return Ok(sessions);
}
