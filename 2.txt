SELECT MIN (EndWeek) FROM (
SELECT DISTINCT TOP 4 EndWeek FROM uvwVerticalSnapshotData WHERE EndWeek <=(
SELECT MAX(EndWeek) FROM uvwVerticalSnapshotData WHERE Vertical = 'Technology')
AND  Vertical = 'Technology'  ORDER BY EndWeek DESC
) as t


 SELECT MIN(EndWeek) FROM (  
        SELECT DISTINCT EndWeek, ROW_NUMBER() OVER (ORDER BY EndWeek DESC) AS rn  
        FROM uvwVerticalSnapshotData WHERE Vertical = 'Technology'  
    ) t WHERE rn <= 4 
