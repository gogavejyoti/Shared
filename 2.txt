getAllDependentSheetsFromSheet: function (sheetIndex) {
    const dependentSheets = new Set();
    dependentSheets.add(sheetIndex); // include current sheet

    if (!h || !h.luckysheetfile) return Array.from(dependentSheets);

    const sheets = h.luckysheetfile;

    for (const sheet of sheets) {
        let calcChain = sheet.calcChain || [];
        calcChain = calcChain.map(u => typeof u === "string" ? JSON.parse(u) : u);

        for (const funcCell of calcChain) {
            const formulaText = funcCell.func && funcCell.func[2];
            if (!formulaText) continue;

            // Check if formula contains reference to current sheet
            const regex = new RegExp(`(?:'[^']+'|${sheetIndex})!`, 'i');
            if (regex.test(formulaText)) {
                dependentSheets.add(sheet.index);
            }
        }
    }

    return Array.from(dependentSheets);
}
