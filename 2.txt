CREATE TABLE ChatHistory (
    Id INT IDENTITY(1,1) PRIMARY KEY,
    SessionId UNIQUEIDENTIFIER,           -- Group messages per session/user
    Role NVARCHAR(20),                    -- 'user' or 'assistant' or 'system'
    MessageText NVARCHAR(MAX),
    CreatedAt DATETIME DEFAULT GETDATE()
);


public class ChatMessage
{
    public Guid SessionId { get; set; }
    public string Role { get; set; }     // "user", "assistant", "system"
    public string MessageText { get; set; }
    public DateTime CreatedAt { get; set; }
}


public async Task SaveChatMessage(ChatMessage message)
{
    using var connection = new SqlConnection(_connectionString);
    await connection.ExecuteAsync(
        @"INSERT INTO ChatHistory (SessionId, Role, MessageText) 
          VALUES (@SessionId, @Role, @MessageText)", message);
}
