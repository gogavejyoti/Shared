        [HttpPost]
        public async Task<JsonResult> GetData([FromBody] HcReconFilter filters)
        {
          var data = await _hcReconService.GetDataAsync(filters);
          var filtered = data.Where(x =>
          (filters.Weeks == null || !filters.Weeks.Any() || filters.Weeks.Contains(x.Week)) &&
          (filters.Geos == null || !filters.Geos.Any() || filters.Geos.Contains(x.Geo))
          ).ToList();

            var response = new
            {
                // Ensure these match the keys used in: data.KPIs.TotalSch, etc.
                KPIs = new
                {
                    TotalSch = filtered.Sum(x => x.SchHC),
                    TotalAct = filtered.Sum(x => x.ActSchHC),
                    TotalDelta = filtered.Sum(x => x.Delta),
                    // Fix: Calculate as a percentage rounded to 1 decimal
                    BillableRate = filtered.Count > 0
              ? Math.Round((double)filtered.Count(x => x.BillableStatus == "Yes") / filtered.Count * 100, 1)
              : 0
                },
                // The Frontend JS looks for 'TableData' (PascalCase) based on my previous script
                TableData = filtered,

                TrendChart = filtered.GroupBy(x => x.Week).Select(g => new {
                    label = g.Key,
                    sch = g.Sum(s => s.SchHC),
                    act = g.Sum(a => a.ActSchHC)
                }).OrderBy(x => x.label).ToList(),

                GeoChart = filtered.GroupBy(x => x.Geo).Select(g => new {
                    label = g.Key,
                    value = g.Sum(s => s.ActSchHC)
                }).ToList(),



            };
            return Json(response);
        }
