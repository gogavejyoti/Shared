<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">Staffing Summary</h5>
    <button id="refreshBtn" class="btn btn-sm btn-primary">ðŸ”„ Refresh</button>
  </div>
  <div id="staffingTableContainer"></div>
</div>

<script>
let data = [
  { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB1", month:"Jan-25", requiredHC:100, availableHC:90 },
  { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB2", month:"Jan-25", requiredHC:50, availableHC:60 },
  { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB1", month:"Feb-25", requiredHC:120, availableHC:130 },
];

function buildStaffingTable(jsonData, containerId) {
    // clear first
    $("#" + containerId).empty();

    // aggregate by month
    const monthMap = {};
    jsonData.forEach(d => {
        if(!monthMap[d.month]){
            monthMap[d.month] = { required:0, available:0 };
        }
        monthMap[d.month].required += d.requiredHC || 0;
        monthMap[d.month].available += d.availableHC || 0;
    });

    let html = `<div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Month</th>
            <th>FTE Required</th>
            <th>FTE Available</th>
            <th>Delta</th>
            <th>Staffing %</th>
          </tr>
        </thead>
        <tbody>`;

    Object.keys(monthMap).forEach(month => {
        const req = monthMap[month].required;
        const ava = monthMap[month].available;
        const delta = ava - req;
        const staffing = req > 0 ? ((ava/req)*100).toFixed(1) + "%" : "N/A";
        const deltaColor = delta < 0 ? "text-danger fw-bold" : "text-success fw-bold";

        html += `<tr>
          <td class="fw-semibold">${month}</td>
          <td>${req}</td>
          <td>${ava}</td>
          <td class="${deltaColor}">${delta}</td>
          <td>${staffing}</td>
        </tr>`;
    });

    html += `</tbody></table></div>`;
    $("#" + containerId).html(html);
}

// Initial load
buildStaffingTable(data, "staffingTableContainer");

// Refresh button
$("#refreshBtn").on("click", function(){
    // Simulate updated data
    data = [
      { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB1", month:"Jan-25", requiredHC:110, availableHC:95 },
      { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB1", month:"Feb-25", requiredHC:120, availableHC:125 },
      { account:"Acc1", geo:"IN", site:"Pune", projectId:1, lob:"LOB2", month:"Mar-25", requiredHC:130, availableHC:140 },
    ];

    buildStaffingTable(data, "staffingTableContainer");
});
</script>
