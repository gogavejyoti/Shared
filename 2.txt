_shiftCrossSheetReference: function (formulaStr, currentSheetIndex) {
    const regex = /([^\!\s]+)!\$?([A-Z]+)\$?(\d+)/g;
    let match;
    let updatedFormula = formulaStr;

    while ((match = regex.exec(formulaStr)) !== null) {
        const sheetName = match[1];
        const col = match[2];
        let row = parseInt(match[3], 10);

        const targetSheet = Ft().find(s => s.name === sheetName);
        if (!targetSheet) continue;

        const changes = h.sheetChanges[targetSheet.index];
        if (changes) {
            // Adjust row for inserted rows
            if (changes.insertedRows) {
                changes.insertedRows.forEach(r => {
                    if (row >= r.start) row += r.count;
                });
            }
            // Adjust row for deleted rows
            if (changes.deletedRows) {
                changes.deletedRows.forEach(r => {
                    if (row >= r.start && row <= r.end) row = r.start; // move to start of deleted range
                    else if (row > r.end) row -= (r.end - r.start + 1);
                });
            }
            // TODO: similar logic for columns
        }

        const newRef = `${sheetName}!${col}${row}`;
        updatedFormula = updatedFormula.replace(match[0], newRef);
    }

    return updatedFormula;
}
