function removeDollarFromCrossSheet(formula) {
    // Match any sheet-qualified reference (with !), including ranges
    const sheetRefRegex = /(?:'([^']+)'|([A-Za-z0-9_]+))!([A-Z$]+)(\d+)(:([A-Z$]+)(\d+))?/g;

    return formula.replace(sheetRefRegex, (match) => {
        // Remove $ only from column/row part, keep sheet name intact
        return match.replace(/\$/g, '');
    });
}
