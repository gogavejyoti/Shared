async function recalcPercentSafe() {
    const sheets = luckysheet.getLuckysheetfile();

    for (let sheetIdx = 0; sheetIdx < sheets.length; sheetIdx++) {
        const sheet = sheets[sheetIdx];
        const chain = sheet.calcChain;
        if (!chain) continue;

        for (let i = 0; i < chain.length; i++) {
            const { r, c } = chain[i];
            const cell = sheet.data[r]?.[c];

            if (cell?.f?.includes("%")) {
                luckysheet.calculateFormula(r, c, sheetIdx);
            }

            // ðŸ”¥ TRUE YIELD â†’ forces browser to free memory
            if (i % 200 === 0) {
                await new Promise(requestAnimationFrame);
            }
        }
    }

    console.log("Recalculation completed without memory overflow.");
}
