        public async Task<string> GetWfmSummaryFromAIAsync(string exceptionSummary)
        {
            var prompt = BuildPrompt(exceptionSummary);

            var requestBody = new
            {
                messages = new[]
                  {
                new { role = "system", content = "You are a Workforce Management domain expert." },
                new { role = "user", content = prompt }
            },
                temperature = 0.4,
                max_tokens = 700,
                top_p = 1,
                frequency_penalty = 0,
                presence_penalty = 0
            };

            using var http = new HttpClient();
            http.DefaultRequestHeaders.Add("api-key", azureApiKey);
            var requestJson = JsonConvert.SerializeObject(requestBody);
            var url = $"{azureEndpoint}openai/deployments/{chatDeployment}/chat/completions?api-version={chatApiVersion}";
            var content = new StringContent(requestJson, Encoding.UTF8, "application/json");

            var response = await http.PostAsync(url, content);
            var responseJson = await response.Content.ReadAsStringAsync();

            if (!response.IsSuccessStatusCode)
                throw new Exception("ChatGPT error: " + responseJson);

            dynamic result = JsonConvert.DeserializeObject(responseJson);
            return result.choices[0].message.content.ToString();
        }
