[RoutePrefix("api/Notes")]
public class NotesController : ApiController
{
    private readonly IDbConnection _db = new SqlConnection(ConfigurationManager.ConnectionStrings["DefaultConnection"].ConnectionString);

    [HttpGet]
    [Route("GetUserNotes")]
    public IHttpActionResult GetUserNotes(int userId)
    {
        var sql = "SELECT TOP 1 NotesText FROM UserNotes WHERE UserId = @UserId";
        var note = _db.QueryFirstOrDefault<string>(sql, new { UserId = userId });
        return Ok(new { NotesText = note ?? "" });
    }

    [HttpPost]
    [Route("SaveUserNotes")]
    public IHttpActionResult SaveUserNotes([FromBody] UserNote note)
    {
        if (note == null) return BadRequest("Invalid data.");

        var sql = @"
            IF EXISTS (SELECT 1 FROM UserNotes WHERE UserId = @UserId)
                UPDATE UserNotes SET NotesText = @NotesText, UpdatedOn = GETDATE() WHERE UserId = @UserId
            ELSE
                INSERT INTO UserNotes (UserId, NotesText, CreatedOn) VALUES (@UserId, @NotesText, GETDATE())";

        _db.Execute(sql, note);
        return Ok();
    }
}

public class UserNote
{
    public int UserId { get; set; }
    public string NotesText { get; set; }
}
