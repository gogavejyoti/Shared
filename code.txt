
const ordered = [];
const visited = {};
const visiting = {};

function visit(k) {
    if (visited[k] || visiting[k]) return;
    visiting[k] = true;

    const node = nodes[k];
    if (node) {
        for (const p in node.parents) {
            if (impacted.has(p)) {
                visit(p);
            }
        }
    }

    visiting[k] = false;
    visited[k] = true;
    ordered.push(node);
}

// ðŸ”‘ find impacted roots (Excel calculation chain roots)
const roots = [];
for (const k of impacted) {
    const node = nodes[k];
    if (!node) continue;

    let hasImpactedParent = false;
    for (const p in node.parents) {
        if (impacted.has(p)) {
            hasImpactedParent = true;
            break;
        }
    }
    if (!hasImpactedParent) {
        roots.push(k);
    }
}

// ðŸ”‘ start DFS ONLY from roots
for (const k of roots) {
    visit(k);
}

// safety: ensure no impacted node is missed
for (const k of impacted) {
    if (!visited[k]) {
        visit(k);
    }
}
ðŸ§ª Why this F
